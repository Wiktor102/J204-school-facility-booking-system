<%- include('../layouts/main', { pageTitle }) %>
<main class="admin-view">
  <section class="panel">
    <header class="panel__header">
      <div>
        <p class="eyebrow">Statystyki</p>
        <h1>Panel administratora</h1>
      </div>
      <div class="stats-grid">
        <div class="stat-pill">
          <p>Aktywne sprzęty</p>
          <strong><%= stats.activeEquipment %></strong>
        </div>
        <div class="stat-pill">
          <p>Łączna liczba rezerwacji</p>
          <strong><%= stats.totalBookings %></strong>
        </div>
      </div>
    </header>
    <% if (typeof formError !== 'undefined') { %>
      <div class="alert alert--danger"><%= formError %></div>
    <% } %>
    <div class="admin-grid">
      <form class="form-card" method="post" action="/admin/equipment">
        <h2>Dodaj nowy sprzęt</h2>
        <div class="form-grid">
          <label>Nazwa
            <input type="text" name="name" required />
          </label>
          <label>Lokalizacja
            <input type="text" name="location" required />
          </label>
          <label>Ikona (słowo kluczowe)
            <input type="text" name="iconName" required />
          </label>
          <label>Kolor akcentu (HEX)
            <input type="text" name="accentColor" value="#00d9ff" required />
          </label>
        </div>
        <div class="form-grid form-grid--compact">
          <label>Start godziny
            <input type="number" name="dailyStartHour" min="0" max="23" value="14" />
          </label>
          <label>Koniec godziny
            <input type="number" name="dailyEndHour" min="0" max="23" value="22" />
          </label>
          <label>Minimalny czas (min)
            <input type="number" name="minDurationMinutes" value="60" />
          </label>
          <label>Maksymalny czas (min)
            <input type="number" name="maxDurationMinutes" value="120" />
          </label>
        </div>
        <button class="btn btn--primary" type="submit">Zapisz</button>
      </form>
      <div class="equipment-table">
        <h2>Zarządzanie sprzętem</h2>
        <table>
          <thead>
            <tr>
              <th>Nazwa</th>
              <th>Lokalizacja</th>
              <th>Godziny</th>
              <th>Status</th>
              <th>Akcje</th>
            </tr>
          </thead>
          <tbody>
            <% equipment.forEach((item) => { %>
              <tr>
                <td><%= item.name %></td>
                <td><%= item.location %></td>
                <td><%= item.dailyStartHour %>:00 - <%= item.dailyEndHour %>:00</td>
                <td>
                  <% if (item.isActive) { %>
                    <span class="badge badge--success">Aktywny</span>
                  <% } else { %>
                    <span class="badge badge--muted">Wyłączony</span>
                  <% } %>
                </td>
                <td>
                  <button
                    class="btn btn--ghost js-equipment-edit"
                    type="button"
                    data-id="<%= item.id %>"
                    data-name="<%= item.name %>"
                    data-location="<%= item.location %>"
                    data-icon-name="<%= item.iconName %>"
                    data-accent-color="<%= item.accentColor %>"
                    data-daily-start-hour="<%= item.dailyStartHour %>"
                    data-daily-end-hour="<%= item.dailyEndHour %>"
                    data-min-duration-minutes="<%= item.minDurationMinutes %>"
                    data-max-duration-minutes="<%= item.maxDurationMinutes %>"
                  >
                    Edytuj
                  </button>
                  <button
                    class="btn btn--ghost js-equipment-toggle"
                    type="button"
                    data-equipment-id="<%= item.id %>"
                    data-next-active="<%= !item.isActive %>"
                  >
                    <%= item.isActive ? 'Wyłącz' : 'Włącz' %>
                  </button>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="panel">
    <header class="panel__header">
      <div>
        <p class="eyebrow">Blokady</p>
        <h2>Zarządzaj blokadami terminów</h2>
      </div>
    </header>
    <form class="form-inline" method="post" action="/admin/blocked-slots">
      <select name="equipmentId" required>
        <% equipment.forEach((item) => { %>
          <option value="<%= item.id %>"><%= item.name %></option>
        <% }) %>
      </select>
      <input type="date" name="blockDate" required />
      <input type="time" name="startTime" required step="60" />
      <input type="time" name="endTime" required step="60" />
      <input type="text" name="reason" placeholder="Powód" />
      <button class="btn btn--ghost" type="submit">Dodaj blokadę</button>
    </form>
    <p class="muted">Wyświetlanie istniejących blokad dostępne w module nadzoru rezerwacji.</p>
  </section>

  <dialog id="editEquipmentModal" class="modal">
    <form method="dialog" class="form-card" style="min-width: 500px;">
      <h2>Edytuj sprzęt</h2>
      <input type="hidden" name="id" id="editId">
      <div class="form-grid">
        <label>Nazwa
          <input type="text" name="name" id="editName" required />
        </label>
        <label>Lokalizacja
          <input type="text" name="location" id="editLocation" required />
        </label>
        <label>Ikona (słowo kluczowe)
          <input type="text" name="iconName" id="editIconName" required />
        </label>
        <label>Kolor akcentu (HEX)
          <input type="text" name="accentColor" id="editAccentColor" required />
        </label>
      </div>
      <div class="form-grid form-grid--compact">
        <label>Start godziny
          <input type="number" name="dailyStartHour" id="editDailyStartHour" min="0" max="23" />
        </label>
        <label>Koniec godziny
          <input type="number" name="dailyEndHour" id="editDailyEndHour" min="0" max="23" />
        </label>
        <label>Minimalny czas (min)
          <input type="number" name="minDurationMinutes" id="editMinDurationMinutes" />
        </label>
        <label>Maksymalny czas (min)
          <input type="number" name="maxDurationMinutes" id="editMaxDurationMinutes" />
        </label>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1rem; justify-content: flex-end;">
        <button class="btn btn--ghost" type="button" id="cancelEdit">Anuluj</button>
        <button class="btn btn--primary" type="submit" id="saveEdit">Zapisz zmiany</button>
      </div>
    </form>
  </dialog>
</main>
<%- include('../partials/footer') %>
