<%- include('../layouts/main', { pageTitle }) %>
<main class="admin-view">
  <section class="panel">
    <header class="panel__header">
      <div>
        <p class="eyebrow">Nadzór</p>
        <h1>Rezerwacje uczniów</h1>
      </div>
      <a class="btn btn--ghost" href="/admin/export">Eksportuj CSV</a>
    </header>
    <form class="filter-bar" method="get" action="/admin/bookings">
      <div class="filter-bar__section filter-bar__section--filters">
        <p class="filter-bar__heading">Filtry</p>
        <div class="filter-bar__controls">
          <label class="filter-bar__field">
            <span>Sprzęt:</span>
            <select name="equipment">
              <option value="">Wszystkie sprzęty</option>
              <% equipment.forEach((item) => { %>
                <option value="<%= item.id %>" <%= filters.equipmentId === item.id ? 'selected' : '' %>>
                  <%= item.name %>
                </option>
              <% }) %>
            </select>
          </label>
          <label class="filter-bar__field">
            <span>Od:</span>
            <input type="date" name="dateFrom" value="<%= filters.dateFrom || '' %>" />
          </label>
          <label class="filter-bar__field">
            <span>Do:</span>
            <input type="date" name="dateTo" value="<%= filters.dateTo || '' %>" />
          </label>
          <label class="filter-bar__field filter-bar__field--search">
            <span>Szukaj ucznia:</span>
            <input
              type="text"
              name="student"
              placeholder="Imię, nazwisko lub email"
              value="<%= filters.student || '' %>"
            />
          </label>
        </div>
        <div class="filter-bar__actions">
          <button class="btn btn--primary" type="submit">Zastosuj filtry</button>
          <a class="btn btn--ghost" href="/admin/bookings">Wyczyść</a>
        </div>
      </div>
      <div class="filter-bar__section filter-bar__section--sorting">
        <p class="filter-bar__heading">Sortowanie</p>
        <div class="filter-bar__sorting">
          <label>
            <span>Kolejność:</span>
            <select name="sort" onchange="this.form.submit()">
              <option value="date" <%= filters.sort === 'date' ? 'selected' : '' %>>Data</option>
              <option value="student" <%= filters.sort === 'student' ? 'selected' : '' %>>Uczeń</option>
              <option value="equipment" <%= filters.sort === 'equipment' ? 'selected' : '' %>>Sprzęt</option>
            </select>
          </label>
          <label>
            <span>Kierunek:</span>
            <select name="order" onchange="this.form.submit()">
              <option value="asc" <%= filters.order === 'asc' ? 'selected' : '' %>>Rosnąco</option>
              <option value="desc" <%= filters.order === 'desc' ? 'selected' : '' %>>Malejąco</option>
            </select>
          </label>
        </div>
      </div>
    </form>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Sprzęt</th>
            <th>Uczeń</th>
            <th>Data</th>
            <th>Godziny</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% if (!bookings.length) { %>
            <tr>
              <td colspan="7">Brak wyników dla zadanych filtrów.</td>
            </tr>
          <% } %>
          <% bookings.forEach((booking) => { %>
            <tr>
              <td>#<%= booking.id %></td>
              <td><%= booking.equipmentName %></td>
              <td><%= booking.userName %></td>
              <td><%= new Date(booking.bookingDate).toLocaleDateString('pl-PL') %></td>
              <td><%= booking.startTime %> - <%= booking.endTime %></td>
              <td>
                <% if (booking.status === 'cancelled') { %>
                  <span class="badge badge--danger">Anulowana</span>
                <% } else { %>
                  <span class="badge badge--success">Aktywna</span>
                <% } %>
              </td>
              <td>
                <% if (booking.status === 'active') { %>
                  <button
                    class="btn btn--ghost js-booking-cancel"
                    type="button"
                    data-booking-id="<%= booking.id %>"
                  >
                    Anuluj
                  </button>
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <div class="pagination">
      <% for (let i = 1; i <= pagination.totalPages; i++) { %>
        <a
          class="pagination__btn <%= pagination.page === i ? 'is-active' : '' %>"
          href="?page=<%= i %>&equipment=<%= filters.equipmentId || '' %>&dateFrom=<%= filters.dateFrom || '' %>&dateTo=<%= filters.dateTo || '' %>&student=<%= filters.student || '' %>&sort=<%= filters.sort %>&order=<%= filters.order %>"
        >
          <%= i %>
        </a>
      <% } %>
    </div>
  </section>
</main>
<%- include('../partials/footer') %>
