<%- include('../layouts/main', { pageTitle }) %>
<main class="admin-view">
  <section class="panel">
    <header class="panel__header">
      <div>
        <p class="eyebrow">Nadzór</p>
        <h1>Rezerwacje uczniów</h1>
      </div>
      <a class="btn btn--ghost" href="/admin/export">Eksportuj CSV</a>
    </header>
    <form class="filter-bar" method="get" action="/admin/bookings">
      <select name="equipment">
        <option value="">Wszystkie sprzęty</option>
        <% equipment.forEach((item) => { %>
          <option value="<%= item.id %>" <%= filters.equipmentId === item.id ? 'selected' : '' %>>
            <%= item.name %>
          </option>
        <% }) %>
      </select>
      <div class="form-grid form-grid--compact">
        <input type="date" name="dateFrom" value="<%= filters.dateFrom || '' %>" />
        <input type="date" name="dateTo" value="<%= filters.dateTo || '' %>" />
      </div>
      <input type="text" name="student" placeholder="Uczeń" value="<%= filters.student || '' %>" />
      <select name="sort">
        <option value="date" <%= filters.sort === 'date' ? 'selected' : '' %>>Data</option>
        <option value="student" <%= filters.sort === 'student' ? 'selected' : '' %>>Uczeń</option>
        <option value="equipment" <%= filters.sort === 'equipment' ? 'selected' : '' %>>Sprzęt</option>
      </select>
      <select name="order">
        <option value="asc" <%= filters.order === 'asc' ? 'selected' : '' %>>Rosnąco</option>
        <option value="desc" <%= filters.order === 'desc' ? 'selected' : '' %>>Malejąco</option>
      </select>
      <button class="btn btn--primary" type="submit">Filtruj</button>
    </form>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Sprzęt</th>
            <th>Uczeń</th>
            <th>Data</th>
            <th>Godziny</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% if (!bookings.length) { %>
            <tr>
              <td colspan="7">Brak wyników dla zadanych filtrów.</td>
            </tr>
          <% } %>
          <% bookings.forEach((booking) => { %>
            <tr>
              <td>#<%= booking.id %></td>
              <td><%= booking.equipmentName %></td>
              <td><%= booking.userName %></td>
              <td><%= new Date(booking.bookingDate).toLocaleDateString('pl-PL') %></td>
              <td><%= booking.startTime %> - <%= booking.endTime %></td>
              <td>
                <% if (booking.status === 'cancelled') { %>
                  <span class="badge badge--danger">Anulowana</span>
                <% } else { %>
                  <span class="badge badge--success">Aktywna</span>
                <% } %>
              </td>
              <td>
                <% if (booking.status === 'active') { %>
                  <button
                    class="btn btn--ghost js-booking-cancel"
                    type="button"
                    data-booking-id="<%= booking.id %>"
                  >
                    Anuluj
                  </button>
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <div class="pagination">
      <% for (let i = 1; i <= pagination.totalPages; i++) { %>
        <a
          class="pagination__btn <%= pagination.page === i ? 'is-active' : '' %>"
          href="?page=<%= i %>&equipment=<%= filters.equipmentId || '' %>&dateFrom=<%= filters.dateFrom || '' %>&dateTo=<%= filters.dateTo || '' %>&student=<%= filters.student || '' %>&sort=<%= filters.sort %>&order=<%= filters.order %>"
        >
          <%= i %>
        </a>
      <% } %>
    </div>
  </section>
</main>
<%- include('../partials/footer') %>
